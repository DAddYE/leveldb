<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Leveldb by DAddYE</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Leveldb</h1>
        <p>LevelDB for Ruby (embedded)</p>

        <p class="view"><a href="https://github.com/DAddYE/leveldb">View the Project on GitHub <small>DAddYE/leveldb</small></a></p>


        <ul>
          <li><a href="https://github.com/DAddYE/leveldb/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/DAddYE/leveldb/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/DAddYE/leveldb">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="leveldb" class="anchor" href="#leveldb"><span class="octicon octicon-link"></span></a>Leveldb</h1>

<p>LevelDB is a database library (C++, 350 kB) written at Google. It is an
embedded database. LevelDB is a persistent ordered map.</p>

<blockquote>
<p>LevelDB stores keys and values in arbitrary byte arrays, and data is sorted by
key. It supports batching writes, forward and backward iteration, and
compression of the data via Google's Snappy compression library.  Still,
LevelDB is not a SQL database. (Wikipedia)</p>
</blockquote>

<h2>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h2>

<ul>
<li>Keys and values are arbitrary byte arrays.</li>
<li>Data is stored <strong>sorted</strong> by key.</li>
<li>Callers can provide a (_soon_) <strong>custom comparison</strong> function to override the sort order.</li>
<li>The basic operations are Put(key,value), Get(key), Delete(key).</li>
<li>Multiple changes can be made in one <strong>atomic batch</strong>.</li>
<li>Users can create a <strong>transient snapshot</strong> to get a consistent view of data.</li>
<li>
<em>Forward</em> and <em>backward</em> iteration is supported over the data.</li>
<li>Data is automatically <strong>compressed</strong> using the <strong>Snappy</strong> compression library.</li>
<li>External activity (file system operations etc.) is relayed through a virtual
interface so users can customize the operating system interactions.</li>
<li>Detailed documentation about how to use the library is included
with the <a href="http://code.google.com/p/leveldb/">source code</a>.</li>
</ul><h2>
<a name="reading" class="anchor" href="#reading"><span class="octicon octicon-link"></span></a>Reading</h2>

<ul>
<li><a href="http://code.google.com/p/leveldb/">LevelDB</a></li>
<li><a href="http://skipperkongen.dk/2013/02/14/having-a-look-at-leveldb/">Great Reading</a></li>
<li><a href="http://daddye.it/leveldb">Website</a></li>
</ul><h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<h3>
<a name="development" class="anchor" href="#development"><span class="octicon octicon-link"></span></a>Development</h3>

<pre><code>$ brew install snappy
$ git clone git://github.com/DAddYE/leveldb.git
$ cd leveldb
$ rake compile
$ rake console
</code></pre>

<h3>
<a name="standard" class="anchor" href="#standard"><span class="octicon octicon-link"></span></a>Standard</h3>

<pre><code>$ brew install snappy
$ gem install leveldb
$ irb -r leveldb
</code></pre>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>Here a basic usage:</p>

<div class="highlight"><pre><span class="n">db</span> <span class="o">=</span> <span class="ss">LevelDB</span><span class="p">:</span><span class="ss">:DB</span><span class="o">.</span><span class="n">new</span> <span class="s1">'/tmp/foo'</span>

<span class="c1"># Writing</span>
<span class="n">db</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">,</span> <span class="s1">'world'</span><span class="p">)</span>
<span class="n">db</span><span class="o">[</span><span class="s1">'hello'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'world'</span>

<span class="c1"># Reading</span>
<span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">)</span> <span class="c1"># =&gt; world</span>
<span class="n">db</span><span class="o">[</span><span class="s1">'hello'</span><span class="o">]</span> <span class="c1"># =&gt; world</span>

<span class="c1"># Deleting</span>
<span class="n">db</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">)</span>

<span class="c1"># Iterating</span>
<span class="n">db</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">"Key: </span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="s2">, Val: </span><span class="si">#{</span><span class="n">val</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
<span class="n">db</span><span class="o">.</span><span class="n">reverse_each</span> <span class="p">{</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">"Key: </span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="s2">, Val: </span><span class="si">#{</span><span class="n">val</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
<span class="n">db</span><span class="o">.</span><span class="n">keys</span>
<span class="n">db</span><span class="o">.</span><span class="n">values</span>
<span class="n">db</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="o">|</span> <span class="n">do_some_with</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="p">}</span>
<span class="n">db</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="o">[]</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">memo</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span><span class="o">|</span> <span class="n">memo</span> <span class="o">&lt;&lt;</span> <span class="n">k</span> <span class="o">+</span> <span class="n">v</span><span class="p">;</span> <span class="n">memo</span> <span class="p">}</span>
<span class="n">db</span><span class="o">.</span><span class="n">each</span> <span class="c1"># =&gt; enumerator</span>
<span class="n">db</span><span class="o">.</span><span class="n">reverse_each</span> <span class="c1"># =&gt; enumerator</span>

<span class="c1"># Ranges</span>
<span class="n">db</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="s1">'c'</span><span class="p">,</span> <span class="s1">'d'</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="o">|</span> <span class="n">do_some_with_only_keys_in_range</span> <span class="p">}</span>
<span class="n">db</span><span class="o">.</span><span class="n">reverse_range</span><span class="p">(</span><span class="s1">'c'</span><span class="p">,</span> <span class="s1">'d'</span><span class="p">)</span> <span class="c1"># =&gt; same as above but results are in reverse order</span>
<span class="n">db</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="p">)</span> <span class="c1"># =&gt; enumerable</span>

<span class="c1"># Batches</span>
<span class="n">db</span><span class="o">.</span><span class="n">batch</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
  <span class="n">b</span><span class="o">.</span><span class="n">put</span> <span class="s1">'a'</span><span class="p">,</span> <span class="mi">1</span>
  <span class="n">b</span><span class="o">.</span><span class="n">put</span> <span class="s1">'b'</span><span class="p">,</span> <span class="mi">2</span>
  <span class="n">b</span><span class="o">.</span><span class="n">delete</span> <span class="s1">'c'</span>
<span class="k">end</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">batch</span>
<span class="n">b</span><span class="o">.</span><span class="n">put</span> <span class="s1">'a'</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">b</span><span class="o">.</span><span class="n">put</span> <span class="s1">'b'</span><span class="p">,</span> <span class="mi">2</span>
<span class="n">b</span><span class="o">.</span><span class="n">delete</span> <span class="s1">'c'</span>
<span class="n">b</span><span class="o">.</span><span class="n">write!</span>

<span class="c1"># Snapshots</span>
<span class="n">db</span><span class="o">.</span><span class="n">put</span> <span class="s1">'a'</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">db</span><span class="o">.</span><span class="n">put</span> <span class="s1">'b'</span><span class="p">,</span> <span class="mi">2</span>
<span class="n">db</span><span class="o">.</span><span class="n">put</span> <span class="s1">'c'</span><span class="p">,</span> <span class="mi">3</span>

<span class="n">snap</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">snapshot</span>

<span class="n">db</span><span class="o">.</span><span class="n">delete</span> <span class="s1">'a'</span>
<span class="n">db</span><span class="o">.</span><span class="n">get</span> <span class="s1">'a'</span> <span class="c1"># =&gt; nil</span>

<span class="n">snap</span><span class="o">.</span><span class="n">set!</span>

<span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span> <span class="c1"># =&gt; 1</span>

<span class="n">snap</span><span class="o">.</span><span class="n">reset!</span>

<span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span> <span class="c1"># =&gt; nil</span>

<span class="n">snap</span><span class="o">.</span><span class="n">set!</span>

<span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span> <span class="c1"># =&gt; 1</span>

<span class="c1"># Properties</span>
<span class="n">db</span><span class="o">.</span><span class="n">read_property</span><span class="p">(</span><span class="s1">'leveldb.stats'</span><span class="p">)</span>

<span class="c1"># Level  Files Size(MB) Time(sec) Read(MB) Write(MB)</span>
<span class="c1"># --------------------------------------------------</span>
<span class="c1">#   0        1        0         0        0         0</span>
<span class="c1">#   1        1        0         0        0         0</span>

<span class="c1"># same of:</span>
<span class="n">db</span><span class="o">.</span><span class="n">stats</span>
</pre></div>

<h2>
<a name="todo" class="anchor" href="#todo"><span class="octicon octicon-link"></span></a>Todo</h2>

<ol>
<li>Add pluggable serializers</li>
<li>Custom comparators</li>
</ol><h2>
<a name="contributing" class="anchor" href="#contributing"><span class="octicon octicon-link"></span></a>Contributing</h2>

<ol>
<li>Fork it</li>
<li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li>
<li>Commit your changes (<code>git commit -am 'Add some feature'</code>)</li>
<li>Push to the branch (<code>git push origin my-new-feature</code>)</li>
<li>Create new Pull Request</li>
</ol>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/DAddYE">DAddYE</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>